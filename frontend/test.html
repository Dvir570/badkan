<!DOCTYPE html>
<html dir='ltr' lang='en'>

<head>
	<title>Test the websocket server</title>
	<script src='jquery-3.2.1.min.js'></script>
	<script src='utils.js'></script>
	<meta charset="utf-8"></meta>
</head>

<body>
<h1>Test the websocket server</h1>
	<form style='border: solid 1px blue; margin: 10px; padding: 5px'>
		<div style="text-align:center">
Enter a message here:
			<br/>
			<input dir="ltr" id='giturl' style='width:30%'/>
    	</div>
		<div style='text-align:center'>
			<button id='submit'>שליחה</button>
		</div>
	</form>

	<h2>Log messages</h2>
	<div id='output' dir='ltr' style='border: dashed 1px green; margin: 10px; padding: 5px'>

	</div>

	<script>
 	    var websocketurl = "ws://127.0.0.1:5678/"

		$("button#submit").click(() => {
            var giturl  = $("input#giturl").val();
			logClient("color:#888", giturl)
            var websocket = new WebSocket(websocketurl);
            websocket.onopen = (event) => {
        		logServer("color:blue", "Connection opened!");
                logClient("color:black; font-style:italic", giturl)
                websocket.send(giturl);
            }
            websocket.onclose = (event) => {
                if (event.code===1000)
        		    logServer("color:blue", "Connection done!");
        		else if (event.code===1006)
        		    logServer("color:red", "Connection closed abnormally!");
        		else
        		    logServer("color:red", "Connection closed abnormally! Code="+event.code+". Reason="+websocketCloseReason(event.code));
        		log("&nbsp;","&nbsp;")
            }
            websocket.onerror = (event) => {
        		logServer("color:red", "Error in websocket.");
            }
            websocket.onmessage = (event) => {
        		logServer("color:green", event.data);
            }

			return false;
		})

	</script>

</body>
</html>
